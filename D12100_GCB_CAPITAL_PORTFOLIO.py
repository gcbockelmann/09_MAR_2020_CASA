# GCB_CAPITAL

#Tenencia_valorizada_a_una_fecha
#PNL a una fecha
#RSI promedio merval
#RSI de mi tenencia

del df
del transacciones
del transacciones2
del df2
del df3
del df4

inicia_df_de_transacciones()

#TXAR 2018
crea_comprobante_compra_normal("2018-03-08", "2018-03-06", 69404, 6800, "TXAR", 14.72, 100096.87, "")
crea_comprobante_dividendos_en_efectivo("2018-04-16", "2018-04-16", 342638, 0, "TXAR", 0, 2189.98, "DIV EFECT 00839")
crea_comprobante_venta("2018-05-08", "2018-05-04", 112808, 6800, "TXAR", 15.03, 102172.35, "")
crea_comprobante_compra_x_ejercicio_prima("2018-06-19", "2018-06-15", 163355, 7000, "TXAR", 14.79, 103520.82, "")
crea_comprobante_venta("2018-06-28", "2018-06-26", 175464, 7000, "TXAR", 15.27, 106913.02, "")
#TXAR 2019
crea_comprobante_compra_normal("2019-02-20", "2019-02-18", 56119, 96053, "TXAR", 16.72, 1606416.53, "")
crea_comprobante_dividendos_en_efectivo("2019-04-15", "2019-04-15", 498757, 0, "TXAR", 0, 47401.74, "DIV EFECT 00839")
crea_comprobante_dividendos_en_efectivo("2019-04-15", "2019-04-15", 499264, 0, "TXAR", 0, 16323.26, "DIV EFECT 00839")
crea_comprobante_compra_normal("2019-05-31", "2019-05-29", 182820, 1459, "TXAR", 12.8, 18681.76, "")
crea_comprobante_compra_normal("2019-06-11", "2019-06-07", 197691, 14621, "TXAR", 12.67, 185208.76, "")
crea_comprobante_compra_normal("2019-08-15", "2019-08-13", 314053, 21860, "TXAR", 11.79, 257705.09, "")
crea_comprobante_compra_normal("2019-08-21", "2019-08-16", 326910, 20708, "TXAR", 12.73, 263701.43, "")
crea_comprobante_compra_normal("2019-08-29", "2019-08-27", 347886, 4447, "TXAR", 11.8, 52458, "")
crea_comprobante_compra_normal("2019-08-30", "2019-08-28", 350144, 4400, "TXAR", 11.9, 52347.2, "")
crea_comprobante_compra_normal("2019-09-02", "2019-08-19", 353442, 2068, "TXAR", 11.85, 24498.93, "")
crea_comprobante_compra_normal("2019-09-03", "2019-08-30", 356546, 593, "TXAR", 11.09, 6576.68, "")
crea_comprobante_compra_normal("2019-09-04", "2019-09-02", 359347, 26534, "TXAR", 11.46, 303961.63, "")
crea_comprobante_compra_normal("2019-09-05", "2019-09-03", 363626, 2222, "TXAR", 10.89, 24195.06, "")
crea_comprobante_compra_normal("2019-09-11", "2019-09-09", 379846, 2400, "TXAR", 13.21, 31698.69, "")
crea_comprobante_compra_normal("2019-09-13", "2019-09-11", 399632, 6431, "TXAR", 14.22, 91423.19, "")
crea_comprobante_compra_normal("2019-09-17", "2019-09-13", 410737, 1352, "TXAR", 15.04, 20331.93, "")
crea_comprobante_compra_normal("2019-10-30", "2019-10-28", 512646, 1000, "TXAR", 21.02, 21021.55, "")
crea_comprobante_compra_normal("2019-11-01", "2019-10-30", 517465, 10000, "TXAR", 22.69, 226851.3, "")
crea_comprobante_venta("2019-11-04", "2019-10-04", 521038, 600, "TXAR", 23.08, 13845.13, "")
crea_comprobante_venta("2019-12-30", "2019-12-26", 674459, 548, "TXAR", 25.67, 14066.39, "")
#TXAR 2020
crea_comprobante_compra_normal("2020-01-20", "2020-01-16", 84645, 7117, "TXAR", 26.31, 187282.29, "")
crea_comprobante_compra_normal("2020-01-22", "2020-01-20", 98234, 50172, "TXAR", 26.76, 1342448.04, "")
crea_comprobante_compra_normal("2020-01-28", "2020-01-24", 127786, 45000, "TXAR", 24.03, 1081537.33, "")


## CTIO
crea_comprobante_compra_normal("2018-09-21", "2018-09-19", 276609, 1000, "CTIO", 42.45, 42446.4, "")
crea_comprobante_compra_normal("2019-02-05", "2019-02-01", 36959, 7196, "CTIO", 42.98, 309299.14, "")
crea_comprobante_compra_normal("2019-02-18", "2019-02-14", 53017, 1588, "CTIO", 44.36, 70446.91, "")
crea_comprobante_venta("2019-03-21", "2019-03-19", 90846, 5770, "CTIO", 51.57, 297571.27, "")
crea_comprobante_venta("2019-03-22", "2019-03-20", 92444, 4014, "CTIO", 51.37, 206214.39, "")
crea_comprobante_compra_normal("2020-01-20", "2020-01-16", 84729, 7616, "CTIO", 70.17, 534411.37, "")
crea_comprobante_compra_normal("2020-01-22", "2020-01-20", 99130, 160, "CTIO", 69.99, 11198.05, "")
crea_comprobante_venta("2020-02-13", "2020-02-11", 206718, 7776, "CTIO", 76.46, 594549.96, "")

# SAMI
crea_comprobante_compra_normal("2019-08-01", "2019-07-30", 281258, 10000, "SAMI", 80.68, 806793.93, "")
crea_comprobante_compra_normal("2019-11-07", "2019-11-04", 530162, 235, "SAMI", 100.72, 23669.66, "")
crea_comprobante_venta("2019-11-07", "2019-11-05", 534364, 235, "SAMI", 109.09, 25637.31, "")
crea_comprobante_venta("2019-12-20", "2019-12-18", 644050, 234, "SAMI", 110.27, 25803.63, "")
crea_comprobante_venta("2019-12-23", "2019-12-19", 650702, 621.2, "SAMI", 112.05, 69607.04, "")
crea_comprobante_venta("2019-12-26", "2019-12-20", 655823, 2314, "SAMI", 109.53, 253462.88, "")
crea_comprobante_venta("2019-12-30", "2019-12-26", 670812, 30, "SAMI", 117.67, 3530.05, "")

# PAMP
crea_comprobante_compra_normal("2017-07-19", "2017-07-14", 138986, 1300, "PAMP", 37.76, 49085.58, "")
crea_comprobante_venta("2017-07-27", "2017-07-24", 146158, 1300, "PAMP", 38.48, 50024.98, "")
crea_comprobante_venta_trading("2019-11-07", "2019-11-05", 534437, 1269, "PAMP", 52.87, 67094.46, "")
crea_comprobante_compra_normal("2019-11-07", "2019-11-04", 532192, 3000, "PAMP", 52.93, 158795.91, "")
crea_comprobante_compra_trading("2019-11-07", "2019-11-05", 536146, 1269, "PAMP", 52.27, 66335.17, "")
crea_comprobante_venta("2019-12-30", "2019-12-26", 6699631, 1500, "PAMP", 48.76, 73133.12, "")


# GOLD
crea_comprobante_compra_normal("2018-05-16", "2018-05-14", 124979, 2, "GOLD", 373.59, 747.17, "")
crea_comprobante_venta("2018-09-18", "2018-09-14", 269107, 303, "GOLD", 404.64, 122606.83, "")
crea_comprobante_compra_normal("2018-10-25", "2018-10-23", 321120, 56, "GOLD", 504.11, 28230.38, "")
crea_comprobante_venta("2018-11-28", "2018-11-26", 355275, 1521, "GOLD", 495.89, 754242.61, "")
crea_comprobante_venta_trading("2018-12-12", "2018-12-10", 367770, 5, "GOLD", 532.7, 2663.5, "")
crea_comprobante_compra_trading("2018-12-12", "2018-12-10", 367898, 5, "GOLD", 540.31, 2701.56, "")
crea_comprobante_compra_normal("2018-12-12", "2018-12-10", 368892, 1982, "GOLD", 539.25, 1068798.31, "")
crea_comprobante_compra_normal("2019-02-22", "2019-02-20", 59836, 907, "GOLD", 579.73, 525816.11, "")
crea_comprobante_compra_normal("2019-03-28", "2019-03-26", 100298, 791, "GOLD", 625.10, 494455.18, "")
crea_comprobante_venta("2019-05-09", "2019-05-07", 151333, 4, "GOLD", 565.31, 2261.24, "")
crea_comprobante_compra_normal("2019-05-30", "2019-05-28", 181372, 100, "GOLD", 527.3, 52730.32, "")
crea_comprobante_venta("2019-06-05", "2019-06-03", 188658, 100, "GOLD", 577.21, 57721.13, "")
crea_comprobante_venta("2019-07-17", "2019-07-15", 256396, 75, "GOLD", 686.64, 51497.76, "")
crea_comprobante_venta("2019-07-18", "2019-07-16", 257535, 242, "GOLD", 692.26, 167526.16, "")
crea_comprobante_venta("2019-08-01", "2019-07-30", 281027, 938, "GOLD", 745.56, 699336.12, "")
crea_comprobante_compra_normal("2019-08-14", "2019-08-12", 309003, 384, "GOLD", 1041.47, 399925.73, "")
crea_comprobante_compra_normal("2019-08-15", "2019-08-13", 313078, 88, "GOLD", 1013.27, 89167.68, "")
crea_comprobante_compra_normal("2019-08-20", "2019-08-15", 320930, 220, "GOLD", 1086.14, 238950.04, "")
crea_comprobante_compra_normal("2019-03-28", "2019-03-26", 100298, 791, "GOLD", 625.10, 494455.18, "")
crea_comprobante_venta("2019-09-04", "2019-09-02", 359414, 140, "GOLD", 1309.14, 183279.47, "")
crea_comprobante_compra_normal("2019-09-06", "2019-09-04", 367026, 48, "GOLD", 1195.76, 57396.4, "")
crea_comprobante_compra_normal("2019-09-09", "2019-09-05", 370736, 42, "GOLD", 1138.79, 47829.32, "")
crea_comprobante_compra_normal("2019-11-08", "2019-11-06", 538280, 844, "GOLD", 1340.88, 1131704.68, "")
crea_comprobante_venta("2019-05-09", "2019-05-05", 604441, 43, "GOLD", 1349.37, 58022.91, "")
crea_comprobante_venta("2019-12-18", "2019-12-16", 634503, 98, "GOLD", 1324.57, 129807.57, "")
crea_comprobante_venta("2019-12-30", "2019-12-26", 669251, 500, "GOLD", 1324.97, 662485.82, "")


# GGAL
#crea_comprobante_compra_normal("2019-10-07", "2019-11-04", 532192, 0, "GGAL", 52.93, 158795.91, "")

################################################################################################################
############################### 
###############################################################################################################


transacciones = df
#df = transacciones
transacciones2 = formato_df_de_transacciones(transacciones)


#################################################################################################################
#### PONE NOMBRE AL DATAFRAME DE TRANSACCIONES PROCESADO
##################################################################################################################

df2 = df
df3 = df
df4 = df


#################################################################################################################
#### GRABA EL DATAFRAME DE TRANSACCIONES EN UN EXCEL
#################################################################################################################

writer = pd.ExcelWriter(original_source + '/PORTFOLIO/transacciones.xlsx', engine='xlsxwriter')
# Write each dataframe to a different worksheet.
df.to_excel(writer, sheet_name='TransaccionesS')
#df2.to_excel(writer, sheet_name='USDARS_LIBRE')
#df3.to_excel(writer, sheet_name='USDARS_PPP')
# Close the Pandas Excel writer and output the Excel file.
writer.save()

#################################################################################################################
#### ARMA MATRICES DE COSTOS Y RENTABILIDAD
#################################################################################################################

arma_y_graba_matriz_de_costos_y_rentabilidades_por_ticker(transacciones, "PAMP", "2020-02-13")
arma_y_graba_matriz_de_costos_y_rentabilidades_por_ticker(transacciones, "CTIO", "2020-02-13")
arma_y_graba_matriz_de_costos_y_rentabilidades_por_ticker(transacciones, "TXAR", "2020-02-13")
arma_y_graba_matriz_de_costos_y_rentabilidades_por_ticker(transacciones, "SAMI", "2020-02-13")
arma_y_graba_matriz_de_costos_y_rentabilidades_por_ticker(transacciones, "GOLD", "2020-02-13")


#################################################################################################################
#### TERMINE DE ARMAR DATOS DE OPERACIONES
##################################################################################################################

df=transacciones

lista_de_cantidades_del_portfolio_final = arma_lista_de_cantidades_del_portfolio_final(df)
lista_de_tickers_actuales_en_portafolio = arma_lista_de_tickers_actuales_en_portafolio(df)
lista_de_costos_en_ars = arma_diccionario_de_costos(arma_lista_de_tickers_actuales_en_portafolio(df),arma_lista_de_costos_de_tenencia(df))

lista_de_costos_en_usd = arma_lista_de_costos_de_tenencia_en_usd(df)
lista_de_costos_en_usdars_ppp = arma_lista_de_costos_de_tenencia_en_usdars_ppp(df)


quantities = convert_two_lists_into_a_dictionary(arma_lista_de_tickers_actuales_en_portafolio(df), arma_lista_de_cantidades_del_portfolio_final(df))

costos_en_usd = convert_two_lists_into_a_dictionary(lista_de_tickers_actuales_en_portafolio , lista_de_costos_en_usd)
costos_en_usdars_ppp = convert_two_lists_into_a_dictionary(lista_de_tickers_actuales_en_portafolio , lista_de_costos_en_usdars_ppp)


#ESTILOS DE DATAFRAME - FORMATO
#df.style.format({'Resultado_Promedio': '{:+.2%}'})




### ARMANDO EL PORTAFOLIO Y VALORIZANDOLO y guarda matriz

valorizacion_actual_del_portfolio_en_pesos("2020-02-13")
    
valorizacion_actual_del_portfolio_en_usd(df)
    
valorizacion_actual_del_portfolio_en_usdars_ppp(df)

guarda_posicion()




################################################################################################
#### 
################################################################################################
#ABRE ARCHIVO

#abre_transacciones_bmb_archivo_excel("BMB")
#arma_matriz_de_transacciones_a_una_fecha(df, "2020-02-10", "BMB_05")

#transacciones=df
#df2 = formato_df_de_transacciones(transacciones)

#transacciones = df2

#list(transacciones["Especie"].drop_duplicates())


#arma_y_graba_matriz_de_costos_y_rentabilidades_por_ticker(transacciones, "GOLD", "2020-02-07")